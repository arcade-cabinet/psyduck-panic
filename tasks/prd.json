{
  "name": "Comprehensive Grok Definitive Code Alignment",
  "description": "Align every component, store, shader, and gameplay system in Cognitive Dissonance v2.0 with the definitive Grok reference code in docs/memory-bank/grok-doc/definitive/. The previous cloud agent deviated from planned designs: fixed-timer spawning instead of tension-proportional, wrong start heights/speeds, broken Tone.js audio, and missing gameplay balance.",
  "branchName": "fix/v2-polish-and-alignment",
  "userStories": [
    {
      "id": "US-007",
      "title": "Restore all deleted Grok documentation",
      "description": "As a developer, I want all Grok reference documentation restored to the repository so definitive code is available.",
      "acceptanceCriteria": [
        "docs/memory-bank/grok-doc/definitive/ restored (25 files)",
        "docs/memory-bank/grok-doc/prose/ restored",
        "docs/code-fragments/ restored (170 versioned iterations)",
        "docs/memory-bank/*.md core files restored (7 files)",
        "docs/Grok-Cognitive_Dissonance_Babylon.js_Shader_Ports.md restored",
        "docs/Grok-Procedural_Robot_Bust_Modeling_Breakdown.md restored",
        "All files verified present in working tree",
        "pnpm test passes",
        "pnpm build passes",
        "pnpm lint passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "",
      "dependsOn": []
    },
    {
      "id": "US-004",
      "title": "Align initial game state and tension",
      "description": "As a player, I want the game to start at tension 0 with a calm atmosphere per Grok definitive.",
      "acceptanceCriteria": [
        "Initial tension: 0 (not 0.12) in src/store/level-store.ts",
        "Reset tension: 0 (not 0.12) in level-store reset()",
        "Audio store initial tension: 0 in src/store/audio-store.ts",
        "All tests updated for tension 0 initial state",
        "Reference: docs/memory-bank/grok-doc/definitive/store/level-store.ts",
        "pnpm test passes",
        "pnpm build passes",
        "pnpm lint passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-007"
      ]
    },
    {
      "id": "US-003",
      "title": "Fix Tone.js audio initialization",
      "description": "As a player, I want audio to initialize without errors so the adaptive soundtrack works.",
      "acceptanceCriteria": [
        "Use Tone.getContext().resume() instead of Tone.start() for dynamic import compatibility",
        "No TypeError: Tone.start is not a function in console",
        "Audio test mock includes getContext export returning { resume: mockFn }",
        "File: src/store/audio-store.ts",
        "Reference: docs/memory-bank/grok-doc/definitive/store/audio-store.ts",
        "pnpm test passes",
        "pnpm build passes",
        "pnpm lint passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-004"
      ]
    },
    {
      "id": "US-001",
      "title": "Align enemy spawner with Grok tension-proportional spawning",
      "description": "As a player, I want enemies to spawn proportionally to tension so the game starts calm and escalates naturally per Grok definitive.",
      "acceptanceCriteria": [
        "Replace fixed spawnTimer with Grok per-frame chance: Math.random() < curTension * 1.1 * dt * (3 + currentLevel * 0.8)",
        "At tension 0, enemies almost never spawn",
        "At tension 0.5, enemies spawn moderately",
        "At tension 1.0, enemies spawn rapidly",
        "Enemy start Y: 18 + Math.random() * 10 * levelMultiplier (was 8 + rng() * 5)",
        "Enemy start X: (Math.random() - 0.5) * 14 * levelMultiplier (was * 6)",
        "Enemy speed: enemyConfig.speed * levelMultiplier * 5 per Grok definitive",
        "Level multiplier: Math.pow(1.35, currentLevel - 1) per Grok definitive",
        "Tension penalty on sphere hit: 0.19 normal, 0.38 boss per Grok definitive",
        "Remove spawnIntervalSeconds import (no longer needed)",
        "Keep 3-second grace period before first spawn check",
        "File: src/components/enemy-spawner.tsx",
        "Reference: docs/memory-bank/grok-doc/definitive/components/enemy-spawner.tsx",
        "pnpm test passes",
        "pnpm build passes",
        "pnpm lint passes",
        "Verify in browser using Playwright MCP - game loads without errors"
      ],
      "priority": 4,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-003"
      ]
    },
    {
      "id": "US-002",
      "title": "Align pattern stabilizer with Grok tension-proportional spawning",
      "description": "As a player, I want corruption patterns to spawn proportionally to tension so early gameplay is manageable per Grok definitive.",
      "acceptanceCriteria": [
        "Replace fixed spawnTimer with Grok per-frame chance: Math.random() < curTension * 1.6 * dt * 7",
        "At tension 0, patterns almost never spawn",
        "Pattern speed: 0.35 + Math.random() * curTension * 1.3 per Grok definitive",
        "Pattern escape tension penalty: 0.25 per Grok definitive (was 0.14)",
        "Remove spawnIntervalSeconds import (no longer needed)",
        "Keep tension decay and addTime calls in tick",
        "Keep stabilization tension relief (0.08)",
        "File: src/components/pattern-stabilizer.tsx",
        "Reference: docs/memory-bank/grok-doc/definitive/components/pattern-stabilizer.tsx",
        "pnpm test passes",
        "pnpm build passes",
        "pnpm lint passes",
        "Verify in browser using Playwright MCP - game loads without errors"
      ],
      "priority": 5,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-001"
      ]
    },
    {
      "id": "US-005",
      "title": "Browser gameplay verification - idle survivability",
      "description": "As a developer, I want to verify the game survives 60+ seconds without input after all alignment changes.",
      "acceptanceCriteria": [
        "Navigate to localhost:3000 via Playwright MCP",
        "Wait for title to fade (8 seconds)",
        "Wait 60 additional seconds",
        "Game is still in playing phase (no COGNITION SHATTERED screen)",
        "Take screenshot to verify visual state",
        "Check console for zero errors",
        "pnpm test passes",
        "pnpm build passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": "",
      "dependsOn": [
        "US-001",
        "US-002"
      ]
    },
    {
      "id": "US-006",
      "title": "Browser gameplay verification - active play",
      "description": "As a developer, I want to verify the game is playable with keyboard input for 120+ seconds.",
      "acceptanceCriteria": [
        "Navigate to localhost:3000 via Playwright MCP",
        "Wait for gameplay to start",
        "Press keys 1-6 and q-y to simulate keycap holds",
        "Game survives 120+ seconds with active play",
        "Tension stays manageable (below 0.7) with active stabilization",
        "Take screenshots at 30s, 60s, 120s intervals"
      ],
      "priority": 7,
      "passes": false,
      "notes": "",
      "dependsOn": [
        "US-005"
      ]
    }
  ],
  "metadata": {
    "updatedAt": "2026-02-18T11:18:39.352Z"
  }
}