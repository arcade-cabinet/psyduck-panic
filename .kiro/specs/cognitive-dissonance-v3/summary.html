<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ralph Loop for Kiro Specs</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 40px 0;
            border-bottom: 2px solid #00ff88;
        }
        
        h1 {
            font-size: 2.5rem;
            color: #00ff88;
            margin-bottom: 10px;
        }
        
        .spec-name {
            font-size: 1.2rem;
            color: #888;
            margin-bottom: 20px;
        }
        
        .status-indicator {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .status-complete {
            background: #00ff88;
            color: #0a0a0a;
        }
        
        .status-incomplete {
            background: #ff4444;
            color: #fff;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .summary-card {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #333;
        }
        
        .summary-card h3 {
            color: #00ff88;
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-transform: uppercase;
        }
        
        .summary-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: #fff;
        }
        
        .content-wrapper {
            display: grid;
            grid-template-columns: 60% 40%;
            gap: 20px;
            margin-top: 30px;
        }
        
        .panel {
            background: #1a1a1a;
            border-radius: 8px;
            border: 1px solid #333;
            padding: 20px;
        }
        
        .panel h2 {
            color: #00ff88;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .task-tree {
            list-style: none;
        }
        
        .task-item {
            margin: 10px 0;
            padding: 10px;
            background: #0f0f0f;
            border-radius: 5px;
            border-left: 3px solid #00ff88;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .task-item:hover {
            background: #1f1f1f;
            transform: translateX(5px);
        }
        
        .task-item.has-children::before {
            content: '▶';
            display: inline-block;
            margin-right: 8px;
            transition: transform 0.2s;
        }
        
        .task-item.expanded::before {
            transform: rotate(90deg);
        }
        
        .task-item.complete {
            border-left-color: #00ff88;
        }
        
        .task-item.failed {
            border-left-color: #ff4444;
        }
        
        .task-item.incomplete {
            border-left-color: #888;
        }
        
        .task-children {
            display: none;
            margin-left: 20px;
            margin-top: 10px;
        }
        
        .task-children.visible {
            display: block;
        }
        
        .task-status {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 8px;
            text-align: center;
            line-height: 20px;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        .task-status.complete {
            background: #00ff88;
            color: #0a0a0a;
        }
        
        .task-status.failed {
            background: #ff4444;
            color: #fff;
        }
        
        .task-status.incomplete {
            background: #888;
            color: #fff;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #333;
        }
        
        th {
            background: #0f0f0f;
            color: #00ff88;
            font-weight: bold;
        }
        
        tr:hover {
            background: #1f1f1f;
        }
        
        details {
            margin: 15px 0;
            padding: 15px;
            background: #0f0f0f;
            border-radius: 5px;
            border: 1px solid #333;
        }
        
        summary {
            cursor: pointer;
            font-weight: bold;
            color: #00ff88;
            padding: 5px;
        }
        
        summary:hover {
            color: #00ffaa;
        }
        
        .tooltip {
            position: fixed;
            background: #1a1a1a;
            border: 2px solid #00ff88;
            border-radius: 8px;
            padding: 15px;
            max-width: 400px;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 20px rgba(0, 255, 136, 0.3);
        }
        
        .tooltip.visible {
            display: block;
        }
        
        .tooltip h4 {
            color: #00ff88;
            margin-bottom: 10px;
        }
        
        .tooltip p {
            margin: 5px 0;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Ralph Loop for Kiro Specs</h1>
            <div class="spec-name">Spec: cognitive-dissonance-v3</div>
            <div class="status-indicator status-complete">✓ SUBSTANTIALLY IMPLEMENTED</div>
        </header>
        
        <div class="summary-grid">
            <div class="summary-card">
                <h3>Total Time</h3>
                <div class="value">1h 32m</div>
            </div>
            <div class="summary-card">
                <h3>Tasks Completed</h3>
                <div class="value">41/45</div>
            </div>
            <div class="summary-card">
                <h3>Date Range</h3>
                <div class="value" style="font-size: 1rem;">2026-02-18 to 2026-02-19</div>
            </div>
            <div class="summary-card">
                <h3>Files Changed</h3>
                <div class="value">200+</div>
            </div>
            <div class="summary-card">
                <h3>Corrections</h3>
                <div class="value">11</div>
            </div>
            <div class="summary-card">
                <h3>Deferred</h3>
                <div class="value">4</div>
            </div>
            <div class="summary-card">
                <h3>Patterns</h3>
                <div class="value">25+</div>
            </div>
        </div>
        
        <details>
            <summary>View Corrections (11 total)</summary>
            <ul style="margin-top: 10px; line-height: 1.8;">
                <li>❌ expo-camera, expo-haptics, expo-speech in app.json plugins → ✅ Remove from plugins array</li>
                <li>❌ world.archetype() and world.createEntity() → ✅ world.with() and world.add() (Miniplex 2.0 API)</li>
                <li>❌ MechanicalDegradationSystem missing leverMesh field → ✅ Add private field declaration</li>
                <li>❌ WebXRFeatureName.ANCHORS in optional features → ✅ Remove (doesn't exist in Babylon.js 8)</li>
                <li>❌ Biome auto-fix removes private field declarations → ✅ Re-add after biome check</li>
                <li>❌ SpatialAudioManager missing scene field → ✅ Add private field declaration</li>
                <li>❌ Jest requires ts-node for TypeScript config → ✅ Install ts-node as dev dependency</li>
                <li>❌ fast-check fc.float() requires Math.fround() → ✅ Use Math.fround() for max constraint</li>
                <li>❌ TensionSystem._checkOverStabilization is private → ✅ Test indirectly via decrease() method</li>
                <li>❌ TensionSystem requires init() before use → ✅ Always call init(mockTensionCurve) in test setup</li>
                <li>❌ useSeedStore.rng() advances RNG state → ✅ Get fresh RNG instance after each setSeed()</li>
            </ul>
        </details>
        
        <details>
            <summary>View Discovered Patterns (25+ total)</summary>
            <ul style="margin-top: 10px; line-height: 1.8;">
                <li>WebGPUEngine and Engine are distinct types — use union type (Engine | WebGPUEngine)</li>
                <li>Scene metadata is canonical for quality config — store qualityConfig and deviceTier</li>
                <li>Miniplex 2.0 uses world.with() for queries, world.add() for entities</li>
                <li>Listener pattern for tension propagation to dependent systems</li>
                <li>SolidParticle.color is Color4, not Color3 — must use Color4 with alpha</li>
                <li>CustomEase.create() returns EaseFunction — reference by name string in GSAP configs</li>
                <li>window.setTimeout for timed disposal, Map for one-per-key constraint tracking</li>
                <li>ShaderMaterial requires explicit attribute and uniform declarations</li>
                <li>Polar coordinate distribution for rim-mounted components</li>
                <li>DefaultRenderingPipeline provides built-in bloom/vignette/chromatic effects</li>
                <li>DynamicTexture context cast to CanvasRenderingContext2D for full canvas API</li>
                <li>TensionSystem listener pattern requires bound function reference for removeListener</li>
                <li>MorphTarget.FromMesh creates morph target, setPositions applies vertex offsets</li>
                <li>GSAP timeline phases with onStart/onComplete callbacks for state machine control</li>
                <li>Platform.OS for web vs native detection, user agent parsing for glasses detection</li>
                <li>WebXRHand.handMesh can be null — must check before accessing children</li>
                <li>PointerInfo.pickInfo contains hit/pickedMesh/pickedPoint/distance for raycast</li>
                <li>ShaderMaterial requires vPosition varying for clip space depth comparison</li>
                <li>Tone.js synth APIs vary by synth type — MetalSynth doesn't accept frequency in options</li>
                <li>expo-speech doesn't have built-in speech recognition — placeholder for future integration</li>
                <li>WebRTC DataChannel requires explicit null checks for createDataChannel return value</li>
                <li>Expo SDK 55 preview uses "next" tag for some packages, not semver range</li>
                <li>Jest requires mocking for @babylonjs ES modules and browser APIs in Node.js</li>
                <li>DreamHandler interface pattern for per-archetype gameplay logic</li>
                <li>Zustand store subscription pattern for phase change orchestration</li>
            </ul>
        </details>
        
        <div class="content-wrapper">
            <div class="panel">
                <h2>Task Tree</h2>
                <div id="taskTree"></div>
            </div>
            
            <div class="panel">
                <h2>Timing Data</h2>
                <div style="max-height: 600px; overflow-y: auto;">
                    <table id="timingTable">
                        <thead>
                            <tr>
                                <th>Task</th>
                                <th>Start</th>
                                <th>End</th>
                                <th>Elapsed</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div id="tooltip" class="tooltip"></div>
    
    <script>
        // Task data with progress details
        const taskData = {
            "1": {
                "name": "Targeted repository cleanup",
                "status": "complete",
                "progress": "Deleted all Next.js-specific files, legacy web files, v2.0 test infrastructure, Tailwind/shadcn remnants, incomplete v2.0 stub, SonarCloud config, v2.0 utility scripts. Updated .gitignore with Expo/Metro ignores.",
                "files": ".gitignore (updated), 15+ files/directories deleted",
                "tools": "bash rm -rf, fs_write",
                "patterns": "None (pure deletion task)",
                "corrections": "None"
            },
            "2": {
                "name": "Project foundation and build system",
                "status": "complete",
                "progress": "Updated package.json, created app.json, eas.json, entry points, metro/babel/tsconfig, ran expo prebuild, created jest/playwright configs",
                "files": "package.json, app.json, eas.json, index.web.tsx, index.native.tsx, App.tsx, metro.config.js, babel.config.js, tsconfig.json, jest.config.ts, playwright.config.ts, android/, ios/",
                "tools": "pnpm install, npx expo install --fix, npx expo prebuild --clean",
                "patterns": "Expo SDK 55 preview uses 'next' tag for some packages",
                "corrections": "expo-camera, expo-haptics, expo-speech must be removed from app.json plugins array"
            },
            "3": {
                "name": "Engine initialization and rendering",
                "status": "complete",
                "progress": "Implemented EngineInitializer with WebGPU detection and WebGL2 fallback, SceneManager with black clear color, PlatformConfig utility",
                "files": "src/engine/EngineInitializer.ts, src/engine/SceneManager.tsx, src/utils/PlatformConfig.ts, App.tsx",
                "tools": "TypeScript compiler (tsc --noEmit)",
                "patterns": "WebGPUEngine and Engine are distinct types — use union type",
                "corrections": "None"
            },
            "4": {
                "name": "Adaptive device quality system",
                "status": "complete",
                "progress": "Implemented DeviceQuality class with tier detection, quality config application, runtime FPS monitoring with automatic tier downgrade",
                "files": "src/utils/DeviceQuality.ts, App.tsx, src/engine/SceneManager.tsx",
                "tools": "TypeScript compiler (tsc --noEmit)",
                "patterns": "Scene metadata is canonical for quality config",
                "corrections": "None"
            },
            "5": {
                "name": "Miniplex ECS world and archetypes",
                "status": "complete",
                "progress": "Implemented consolidated Miniplex World with all archetype queries, GameEntity type, spawnDreamFromSeed function, helper functions for seed-derived parameters",
                "files": "src/types/index.ts, src/utils/seed-helpers.ts, src/ecs/World.ts",
                "tools": "TypeScript compiler (tsc --noEmit)",
                "patterns": "Miniplex 2.0 uses world.with() for queries, world.add() for entities",
                "corrections": "Miniplex 2.0 API correction (world.archetype() → world.with())"
            }
        };
        
        // Timing data
        const timingData = [
            ["Task 1", "2026-02-18 22:36:40", "2026-02-18 22:38:05", "1m 26s"],
            ["Task 2", "2026-02-18 22:39:06", "2026-02-18 22:43:34", "4m 28s"],
            ["Task 3", "2026-02-18 22:44:46", "2026-02-18 22:46:41", "1m 55s"],
            ["Task 4", "2026-02-18 22:47:35", "2026-02-18 22:49:31", "1m 56s"],
            ["Task 5", "2026-02-18 22:50:37", "2026-02-18 22:53:59", "3m 23s"],
            ["Task 6", "2026-02-18 22:54:52", "2026-02-18 22:55:44", "0m 52s"],
            ["Task 7", "2026-02-18 22:56:46", "2026-02-18 22:58:32", "1m 46s"],
            ["Task 8", "2026-02-18 22:59:36", "2026-02-18 23:02:13", "2m 37s"],
            ["Task 9", "2026-02-18 23:03:16", "2026-02-18 23:05:08", "1m 51s"],
            ["Task 10", "2026-02-18 23:07:38", "2026-02-18 23:10:27", "2m 49s"],
            ["Task 11", "2026-02-18 23:11:28", "2026-02-18 23:12:23", "0m 56s"],
            ["Task 12", "2026-02-18 23:13:11", "2026-02-18 23:14:04", "0m 53s"],
            ["Task 13", "2026-02-18 23:15:00", "2026-02-18 23:17:10", "2m 10s"],
            ["Task 14", "2026-02-18 23:18:06", "2026-02-18 23:19:32", "1m 26s"],
            ["Task 15", "2026-02-18 23:20:31", "2026-02-18 23:22:05", "1m 35s"],
            ["Task 16", "2026-02-18 23:22:54", "2026-02-18 23:24:41", "1m 46s"],
            ["Task 17", "2026-02-18 23:25:53", "2026-02-18 23:27:56", "2m 3s"],
            ["Task 18", "2026-02-18 23:29:30", "2026-02-18 23:31:19", "1m 48s"],
            ["Task 19", "2026-02-18 23:32:36", "2026-02-18 23:34:53", "2m 17s"],
            ["Task 20", "2026-02-18 23:35:57", "2026-02-18 23:38:03", "2m 5s"],
            ["Task 21", "2026-02-18 23:40:11", "2026-02-18 23:43:31", "3m 21s"],
            ["Task 22", "2026-02-18 23:44:47", "2026-02-18 23:46:12", "1m 24s"],
            ["Task 23", "2026-02-18 23:47:18", "2026-02-18 23:49:14", "1m 56s"],
            ["Task 24", "2026-02-18 23:51:20", "2026-02-18 23:53:25", "2m 5s"],
            ["Task 25", "2026-02-18 23:54:47", "2026-02-18 23:56:58", "2m 11s"],
            ["Task 26", "2026-02-18 23:57:40", "2026-02-19 00:00:20", "2m 39s"],
            ["Task 27.1-27.2", "2026-02-19 00:01:29", "2026-02-19 00:01:51", "0m 22s"],
            ["Task 28", "2026-02-19 00:02:34", "2026-02-19 00:04:06", "1m 32s"],
            ["Task 29", "2026-02-19 00:05:16", "2026-02-19 00:05:44", "0m 30s"],
            ["Task 30", "2026-02-19 00:06:46", "2026-02-19 00:13:20", "6m 34s"],
            ["Task 31", "2026-02-19 00:15:07", "2026-02-19 00:19:59", "4m 52s"],
            ["Task 32", "2026-02-19 00:21:47", "2026-02-19 00:25:11", "3m 25s"],
            ["Task 33", "2026-02-19 00:26:44", "2026-02-19 00:28:53", "2m 9s"],
            ["Task 34", "2026-02-19 00:30:02", "2026-02-19 00:34:14", "4m 11s"],
            ["Task 35", "2026-02-19 00:35:14", "2026-02-19 00:36:57", "1m 42s"],
            ["Task 36", "2026-02-19 00:37:53", "2026-02-19 00:40:31", "2m 38s"],
            ["Task 37", "2026-02-19 00:41:24", "2026-02-19 00:43:08", "1m 44s"],
            ["Task 38", "2026-02-19 00:44:06", "2026-02-19 00:46:23", "2m 17s"],
            ["Task 39", "2026-02-19 00:47:45", "2026-02-19 00:50:46", "3m 1s"],
            ["Task 40", "2026-02-19 00:52:01", "2026-02-19 00:54:13", "2m 12s"],
            ["Task 41", "2026-02-19 00:55:07", "2026-02-19 00:57:00", "1m 53s"],
            ["Task 42", "2026-02-19 00:58:24", "2026-02-19 01:03:37", "5m 13s"],
            ["Task 43", "2026-02-19 01:04:48", "2026-02-19 01:07:05", "2m 17s"],
            ["Task 44-45", "2026-02-19 01:08:24", "2026-02-19 01:09:15", "0m 51s"]
        ];
        
        // Populate timing table
        const tbody = document.querySelector('#timingTable tbody');
        timingData.forEach(row => {
            const tr = document.createElement('tr');
            row.forEach(cell => {
                const td = document.createElement('td');
                td.textContent = cell;
                tr.appendChild(td);
            });
            tbody.appendChild(tr);
        });
        
        // Build task tree (simplified - showing first 5 tasks as example)
        const taskTree = document.getElementById('taskTree');
        const tasks = [
            { id: "1", name: "Targeted repository cleanup", complete: true, children: [] },
            { id: "2", name: "Project foundation and build system", complete: true, children: [] },
            { id: "3", name: "Engine initialization and rendering", complete: true, children: [] },
            { id: "4", name: "Adaptive device quality system", complete: true, children: [] },
            { id: "5", name: "Miniplex ECS world and archetypes", complete: true, children: [] },
            { id: "6-24", name: "Tasks 6-24 (all complete)", complete: true, children: [] },
            { id: "25", name: "Accessibility and voice commands", complete: true, children: [], note: "Voice recognition is placeholder - processing pipeline works but no speech input" },
            { id: "26-37", name: "Tasks 26-37 (all complete)", complete: true, children: [] },
            { id: "38", name: "Babylon Native integration", complete: true, children: [], note: "Native modules are stubs - TS wrapper complete, Swift/Kotlin placeholder" },
            { id: "39", name: "AR integration", complete: true, children: [], note: "ARKit/ARCore integrations are stubs - WebXR integration complete" },
            { id: "40-41", name: "Tasks 40-41 (all complete)", complete: true, children: [] },
            { id: "42", name: "Physics engine configuration", complete: true, children: [], note: "6DoF/hinge constraints deferred - basic PhysicsAggregate works" },
            { id: "43-45", name: "Tasks 43-45 (all complete)", complete: true, children: [] }
        ];
        
        tasks.forEach(task => {
            const div = document.createElement('div');
            div.className = 'task-item complete';

            const statusSpan = document.createElement('span');
            statusSpan.className = 'task-status complete';
            statusSpan.textContent = '\u2713';
            div.appendChild(statusSpan);

            const label = document.createTextNode('Task ' + task.id + ': ' + task.name);
            div.appendChild(label);

            if (task.note) {
                const br = document.createElement('br');
                div.appendChild(br);
                const noteEl = document.createElement('small');
                noteEl.style.color = '#ffaa00';
                noteEl.style.marginLeft = '28px';
                noteEl.textContent = '\u26A0 ' + task.note;
                div.appendChild(noteEl);
            }

            div.addEventListener('mouseenter', (e) => showTooltip(e, task.id));
            div.addEventListener('mouseleave', hideTooltip);
            taskTree.appendChild(div);
        });
        
        // Tooltip functionality
        const tooltip = document.getElementById('tooltip');
        
        function showTooltip(e, taskId) {
            const data = taskData[taskId];
            if (!data) return;
            
            tooltip.innerHTML = `
                <h4>Task ${taskId}: ${data.name}</h4>
                <p><strong>Status:</strong> ${data.status}</p>
                <p><strong>Progress:</strong> ${data.progress}</p>
                <p><strong>Files:</strong> ${data.files}</p>
                <p><strong>Tools:</strong> ${data.tools}</p>
                <p><strong>Patterns:</strong> ${data.patterns}</p>
                <p><strong>Corrections:</strong> ${data.corrections}</p>
            `;
            
            tooltip.style.left = e.pageX + 20 + 'px';
            tooltip.style.top = e.pageY + 'px';
            tooltip.classList.add('visible');
        }
        
        function hideTooltip() {
            tooltip.classList.remove('visible');
        }
    </script>
</body>
</html>
